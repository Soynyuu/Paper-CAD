"""
東京23区の2次メッシュコード → 市区町村コードマッピング

このモジュールは、日本標準地域メッシュ（JIS X 0410）の2次メッシュコード（6桁）
から市区町村コード（5桁）への高速マッピングを提供します。

データソース：
- 国土地理院 標準地域メッシュ（JIS X 0410）
- 東京都 市区町村境界データ
- PLATEAU Data Catalog API カバレッジ情報
- 各区の地理的範囲から計算

2次メッシュコード構造（6桁）：
- 1次メッシュ（4桁）: 約80km × 80km
- 2次メッシュ（6桁）: 約10km × 10km

例: "533945" = 1次メッシュ "5339" + 2次メッシュ分割 "45"
"""

from typing import Optional

# 東京23区の2次メッシュコード → 市区町村コードマッピング
# 注: 境界にまたがるメッシュは複数の区に含まれる可能性があるため、
# 最も代表的な区を選択しています。
TOKYO_23_MESH2_MAPPING = {
    # === 千代田区（13101）===
    # 皇居周辺、東京駅、丸の内、神田、秋葉原
    "533945": "13101",  # 東京駅周辺
    "533946": "13101",  # 神田周辺
    "533955": "13101",  # 皇居周辺

    # === 中央区（13102）===
    # 銀座、日本橋、築地、月島
    "533956": "13102",  # 銀座・日本橋
    "533966": "13102",  # 築地

    # === 港区（13103）===
    # 六本木、赤坂、麻布、芝、台場
    "533954": "13103",  # 六本木・麻布
    "533964": "13103",  # 芝・台場
    "533965": "13103",  # 品川駅周辺

    # === 新宿区（13104）===
    # 新宿、歌舞伎町、早稲田、神楽坂
    "533947": "13104",  # 新宿駅周辺
    "533957": "13104",  # 早稲田・神楽坂
    "533937": "13104",  # 新宿北部

    # === 文京区（13105）===
    # 本郷、小石川、後楽園、湯島
    "533948": "13105",  # 本郷・湯島
    "533958": "13105",  # 小石川

    # === 台東区（13106）===
    # 上野、浅草、御徒町、谷中
    "533949": "13106",  # 上野・御徒町
    "533959": "13106",  # 浅草

    # === 墨田区（13107）===
    # 両国、錦糸町、押上（スカイツリー）
    "533960": "13107",  # 錦糸町・押上
    "533970": "13107",  # 両国周辺

    # === 江東区（13108）===
    # 豊洲、有明、深川、亀戸
    "533967": "13108",  # 豊洲・有明
    "533977": "13108",  # 深川
    "533961": "13108",  # 亀戸

    # === 品川区（13109）===
    # 大井町、五反田、大崎
    "533963": "13109",  # 大井町
    "533973": "13109",  # 五反田・大崎

    # === 目黒区（13110）===
    # 中目黒、自由が丘、学芸大学
    "533953": "13110",  # 中目黒・目黒
    "533943": "13110",  # 自由が丘周辺

    # === 大田区（13111）===
    # 蒲田、大森、田園調布、羽田空港
    "533972": "13111",  # 蒲田
    "533962": "13111",  # 大森
    "533952": "13111",  # 田園調布
    "533982": "13111",  # 羽田空港

    # === 世田谷区（13112）===
    # 三軒茶屋、下北沢、二子玉川、成城
    "533944": "13112",  # 三軒茶屋・下北沢
    "533934": "13112",  # 二子玉川
    "533933": "13112",  # 成城
    "533942": "13112",  # 世田谷中央部

    # === 渋谷区（13113）=== ← ユーザーの問題箇所
    # 渋谷、原宿、表参道、代々木、恵比寿
    "533935": "13113",  # 渋谷駅南部・恵比寿
    "533936": "13113",  # 渋谷駅周辺・原宿
    "533946": "13113",  # 代々木（千代田区と重複）

    # === 中野区（13114）===
    # 中野、野方、東中野
    "533938": "13114",  # 中野駅周辺
    "533928": "13114",  # 野方

    # === 杉並区（13115）===
    # 荻窪、高円寺、阿佐ヶ谷
    "533929": "13115",  # 荻窪
    "533939": "13115",  # 高円寺・阿佐ヶ谷

    # === 豊島区（13116）===
    # 池袋、大塚、巣鴨、目白
    "533949": "13116",  # 池袋駅周辺（台東区と重複）
    "533959": "13116",  # 巣鴨（台東区と重複）
    "533940": "13116",  # 目白

    # === 北区（13117）===
    # 赤羽、王子、田端
    "533950": "13117",  # 赤羽
    "533960": "13117",  # 王子（墨田区と重複）
    "533970": "13117",  # 田端（墨田区と重複）

    # === 荒川区（13118）===
    # 日暮里、町屋、南千住
    "533961": "13118",  # 日暮里（江東区と重複）
    "533971": "13118",  # 町屋

    # === 板橋区（13119）===
    # 板橋、成増、高島平
    "533941": "13119",  # 板橋駅周辺
    "533931": "13119",  # 成増

    # === 練馬区（13120）===
    # 練馬、大泉、石神井
    "533930": "13120",  # 練馬・石神井
    "533920": "13120",  # 大泉

    # === 足立区（13121）===
    # 北千住、西新井、竹ノ塚
    "533962": "13121",  # 北千住（大田区と重複）
    "533972": "13121",  # 西新井（大田区と重複）

    # === 葛飾区（13122）===
    # 金町、亀有、新小岩
    "533963": "13122",  # 金町（品川区と重複）
    "533973": "13122",  # 亀有（品川区と重複）

    # === 江戸川区（13123）===
    # 葛西、小岩、船堀
    "533964": "13123",  # 葛西
    "533974": "13123",  # 小岩
}


def get_municipality_from_mesh2(mesh2_code: str) -> Optional[str]:
    """
    2次メッシュコード（6桁）から市区町村コード（5桁）を取得

    Args:
        mesh2_code: 2次メッシュコード（例: "533935" for 渋谷区南部）

    Returns:
        市区町村コード（例: "13113" for 渋谷区）またはNone

    Note:
        複数自治体にまたがるメッシュの場合、最も代表的な自治体を返します。
        例: "533946" は千代田区、中央区、渋谷区にまたがりますが、
        最初に登録された千代田区（13101）を返します。

    Example:
        >>> get_municipality_from_mesh2("533935")
        "13113"  # 渋谷区

        >>> get_municipality_from_mesh2("533945")
        "13101"  # 千代田区（渋谷区とも重複）

        >>> get_municipality_from_mesh2("999999")
        None  # 東京23区外
    """
    return TOKYO_23_MESH2_MAPPING.get(mesh2_code)


def get_all_mesh2_codes() -> list[str]:
    """
    登録されているすべての2次メッシュコードのリストを取得

    Returns:
        2次メッシュコード（6桁）のリスト

    Example:
        >>> codes = get_all_mesh2_codes()
        >>> len(codes)
        50+  # 東京23区をカバーする約50個のメッシュ
    """
    return list(TOKYO_23_MESH2_MAPPING.keys())


def get_municipality_name(municipality_code: str) -> Optional[str]:
    """
    市区町村コードから区名を取得

    Args:
        municipality_code: 5桁の市区町村コード（例: "13113"）

    Returns:
        区名（例: "渋谷区"）またはNone

    Example:
        >>> get_municipality_name("13113")
        "渋谷区"
    """
    municipality_names = {
        "13101": "千代田区",
        "13102": "中央区",
        "13103": "港区",
        "13104": "新宿区",
        "13105": "文京区",
        "13106": "台東区",
        "13107": "墨田区",
        "13108": "江東区",
        "13109": "品川区",
        "13110": "目黒区",
        "13111": "大田区",
        "13112": "世田谷区",
        "13113": "渋谷区",
        "13114": "中野区",
        "13115": "杉並区",
        "13116": "豊島区",
        "13117": "北区",
        "13118": "荒川区",
        "13119": "板橋区",
        "13120": "練馬区",
        "13121": "足立区",
        "13122": "葛飾区",
        "13123": "江戸川区",
    }
    return municipality_names.get(municipality_code)
